/**************************************************************************************************
//程序名称 ：定时器0
//应用芯片 ：
//设计单位 ：
//设计作者 ：Yanggang
//创建日期 ：2011年8月8日
//修改作者 ： 
//修改日期 ： 
//版本 ： V1.0
//版权 ：
//------------------------------------------------------------------------------------------------
//程序功能描述 ： 
//--------------
//--------------
//--------------
//------------------------------------------------------------------------------------------------
**************************************************************************************************/

/**************************************************************************************************
** 编译预处理 ：文件包含；宏定义；变量声明；函数声明
** 应用描述 ：
** 其他说明 ：无
**************************************************************************************************/

/*---------------包含头文件--------------------*/
#include"Time0.h"

/******************************************************************
 - 功能描述：启动定时器0
 - 隶属模块：定时器模块
 - 函数属性：外部，供用户使用
 - 参数说明：无      
 - 返回说明：无
 - 注：无
 *****************************************************************

void Time0_Start()
{
 	TR0=1;     //启动定时器0，定时器0启动后[TH0-TL0]立即从其初始值开始自增
} 
 */
/******************************************************************
 - 功能描述：停止定时器0
 - 隶属模块：定时器模块
 - 函数属性：外部，供用户使用
 - 参数说明：无      
 - 返回说明：无
 - 注：无
 *****************************************************************

void Time0_Stop()
{
 	TR0=0;     //停止定时器0，定时器0停止后[TH0-TL0]立即停止自增
} 
*/
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////定时器0工作方式0////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/******************************************************************
 - 功能描述：初始化定时器0工作方式0
 - 隶属模块：定时器模块
 - 函数属性：外部，供用户使用
 - 参数说明：无      
 - 返回说明：无
 - 注：无
 ******************************************************************

void Time0_Init()
{

	 TMOD|=0x00;  //确定工作方式，对TMOD进行赋值，设置定时器0为工作方式0(13位定时器) TH0的8位，THL低5位
	              //TMOD----GATE C/T  M1 MO GATE C/T  M1 MO (C/T--定时器/计数器选择位、GATE门控制位、M1 M0位工作方式选择位)
	 TH0=(8192-value)/32;	//计数初值，并写入TH0，TL0或TH1，TL1 
	 TL0=(8192-value)%32;
	
	 EA=1;		//打开总中断(要使某中断真正使能，除了置位相应的中断使能位，还必须置位全局中断使能位)                        
	 ET0=1;		//打开定时器0中断
	 TR0=1;     //启动定时器0
}



/******************************************************************
 - 功能描述：定时器0中断服务函数
 - 隶属模块：定时器模块
 - 函数属性：中断函数，由用户加入中断服务代码
 - 参数说明：无      
 - 返回说明：无
 - 注：
 *****************************************************************

void Time0() interrupt 1
{
	 TH0=(8192-value)/32;	//定时器T0工作方式0重装初值 
	 TL0=(8192-value)%32;
	 //中断服务程序                   
}

*/



/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////定时器0工作方式1///////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/******************************************************************
 - 功能描述：初始化定时器0工作方式1
 - 隶属模块：定时器模块
 - 函数属性：外部，供用户使用
 - 参数说明：无      
 - 返回说明：无
 - 注：无
 ******************************************************************/

//void Time0_Init()
//{

//	 TMOD |= 0x01;  //确定工作方式，对TMOD进行赋值，设置计数器0为工作方式1(16位定时器)
//	              //TMOD----GATE C/T  M1 MO GATE C/T  M1 MO (C/T--定时器/计数器选择位、GATE门控制位、M1 M0位工作方式选择位)
//	 TH0=(65536-2000)/256;	// 
//	 TL0=(65536-2000)%256;	
//	 	
//	 TR0=1;     //启动定时器0
//	 ET0=1;		//打开定时器0中断
//	 EA=1;		//打开总中断(要使某中断真正使能，除了置位相应的中断使能位，还必须置位全局中断使能位)                        
//	 
//	 
//}



/******************************************************************
 - 功能描述：定时器0中断服务函数
 - 隶属模块：定时器模块
 - 函数属性：中断函数，由用户加入中断服务代码
 - 参数说明：无      
 - 返回说明：无
 - 注：
 ******************************************************************/

//void Time0() interrupt 1
//{	  
//	TH0=(65536-2000)/256;		  //重新赋值 2ms
//	TL0=(65536-2000)%256;
//	
//	Time++;
//	Tms1++;
//	Tms2++;
//	if(Tms2==300)
//	{
//		Tms2=0;
////		ReadTempFlag=1;
//	}
//	if(Time>=120*500)	//设置自动关机时间"30*500"为30S
//	{ 	
//		Time=0;		
//		TM1650_Send(0X68,0X00);  //GID1	 //数码管不显示
//		TM1650_Send(0X6A,0X00);  //GID2
//		TM1650_Send(0X6C,0X00);  //GID3
//		TM1650_Send(0X6E,0X00);  //GID4   
//		Stop_Start=0;		
//		ET0=0;	 //关闭数码管显示
//	} 
//}




/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////定时器0工作方式2//////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/******************************************************************
 - 功能描述：初始化定时器0工作方式2
 - 隶属模块：定时器模块
 - 函数属性：外部，供用户使用
 - 参数说明：无      
 - 返回说明：无
 - 注：无
 ******************************************************************

void Time0_Init()
{
	 TMOD|=0x02;  //确定工作方式，对TMOD进行赋值，设置定时器0为工作方式2(8位自动重装初值定时器)
	              //TMOD----GATE C/T  M1 MO GATE C/T  M1 MO (C/T--定时器/计数器选择位、GATE门控制位、M1 M0位工作方式选择位)
	 TH0=256-value;	//计数初值，并写入TH0，TL0或TH1，TL1 
	 TL0=256-value;
	 
	 EA=1;		//打开总中断(要使某中断真正使能，除了置位相应的中断使能位，还必须置位全局中断使能位)                        
	 ET0=1;		//打开定时器0中断
	 TR0=1;     //启动定时器0
}

/******************************************************************
 - 功能描述：定时器0中断服务函数
 - 隶属模块：定时器模块
 - 函数属性：中断函数，由用户加入中断服务代码
 - 参数说明：无      
 - 返回说明：无
 - 注：
 ******************************************************************

void Time0() interrupt 1
{
	//定时器0工作在工作方式2为自动重装初值工作方式不需重装初值
	//中断服务程序                    
}
*/


/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////定时器0工作方式3//////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
/******************************************************************
 - 功能描述：初始化定时器0工作方式3
 - 隶属模块：定时器模块
 - 函数属性：外部，供用户使用
 - 参数说明：无      
 - 返回说明：无
 - 注：无
 ******************************************************************

void Time0_Init()
{
/////注：定时器0工作在工作方式3时占用定时器1的中断服务函数，此时通常将定时器1用作串行口的波特率发生器
	 TMOD|=0x03;  //确定工作方式，对TMOD进行赋值，设置定时器0为工作方式3(8位定时器,可构成两个定时器或一个定时器一个计数器)
	              //TMOD----GATE C/T  M1 MO GATE C/T  M1 MO (C/T--定时器/计数器选择位、GATE门控制位、M1 M0位工作方式选择位)
	 TH0=256-value;	//计数初值，进入定时器1的中断服务函数
	 TL0=256-value;	//计数初值，进入定时器0的中断服务函数

	 
	 EA=1;		//打开总中断(要使某中断真正使能，除了置位相应的中断使能位，还必须置位全局中断使能位)                        
	 ET0=1;		//打开定时器0中断
	 ET1=1;		//打开定时器1中断
	 TR0=1;     //启动定时器0
	 TR1=1;     //启动定时器0的高8位计数器
}

/******************************************************************
 - 功能描述：定时器0中断服务函数
 - 隶属模块：定时器模块
 - 函数属性：中断函数，由用户加入中断服务代码
 - 参数说明：无      
 - 返回说明：无
 - 注：
 ******************************************************************

void Time0() interrupt 1
{
	TL0=256-value;//重装初值
	//中断服务程序                   
}


/******************************************************************
 - 功能描述：定时器1中断服务函数
 - 隶属模块：定时器模块
 - 函数属性：中断函数，由用户加入中断服务代码
 - 参数说明：无      
 - 返回说明：无
 - 注：
 *******************************************************************

void Time1() interrupt 3
{
	TH0=256-value;//重装初值
	//中断服务程序                     
}
*/



